# yume_prompt_engine/character_prompt.py

class CharacterPromptBuilder:
    """
    Builds character-specific prompt segments based on
    stored appearance, personality tags, and scene context.
    """

    def __init__(self, character_db):
        """
        character_db: Dict loaded from yume_characters/profiles/
        Example: {"ram": {...}, "gopal": {...}}
        """
        self.character_db = character_db

    def build(self, character_name, mood=None, action=None):
        """
        Returns a text description for this character to be inserted into the final prompt.
        """

        char = self.character_db.get(character_name.lower())
        if not char:
            return f"{character_name}"

        appearance = char.get("appearance", "")
        clothing = char.get("clothing", "")
        traits = ", ".join(char.get("traits", []))

        prompt_parts = [
            f"{character_name}",
            f"{appearance}",
            f"wearing {clothing}" if clothing else "",
            f"with personality traits: {traits}" if traits else "",
        ]

        if mood:
            prompt_parts.append(f"expressing a {mood} mood")

        if action:
            prompt_parts.append(f"currently {action}")

        # Filter empty strings + join
        return ", ".join([p for p in prompt_parts if p])
